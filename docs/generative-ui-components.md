# 🎨 Componentes de UI Generativa

## 📋 Componentes Implementados

**✅ Funcionais no MVP:**

- `FlightsList` - Cards de voos com ações
- `HotelsList` - Grid de hotéis
- `BookingConfirmation` - Confirmação de reservas
- `MessageBubble` - Chat streaming
- `TypingIndicator` - Feedback visual

## 🏗️ Arquitetura de Componentes

### Component Registry Pattern

```typescript
// Registry centralizado de todos os componentes UI
const UI_COMPONENTS = {
  'FlightsList': FlightsList,
  'HotelsList': HotelsList,
  'BookingConfirmation': BookingConfirmation,
  'SearchForm': SearchForm,
  'LoadingSkeleton': LoadingSkeleton,
  'ErrorBoundary': ErrorBoundary
} as const;

// Dynamic component resolution
const AgentUIRenderer = ({ artifact }: { artifact: UIArtifact }) => {
  const Component = UI_COMPONENTS[artifact.component];
  return <Component {...artifact.props} />;
};
```

## ✈️ Flight Components

### `FlightsList`

**Props Interface**:

```typescript
interface FlightsListProps {
  flights: Flight[];
  searchParams: FlightSearchParams;
  onBook: (flightId: string) => void;
  onSort: (field: SortField) => void;
  loading?: boolean;
  error?: string | null;
  className?: string;
}
```

**Component Structure**:

```typescript
const FlightsList: FC<FlightsListProps> = ({
  flights,
  searchParams,
  onBook,
  onSort,
  loading = false,
  error = null
}) => {
  // Sorting state
  const [sortField, setSortField] = useState<SortField>('price');
  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('asc');

  // Filter state
  const [filters, setFilters] = useState<FlightFilters>({
    maxStops: undefined,
    airlines: [],
    priceRange: { min: 0, max: Infinity }
  });

  const sortedFlights = useMemo(() =>
    applySortAndFilter(flights, sortField, sortDirection, filters),
    [flights, sortField, sortDirection, filters]
  );

  if (loading) return <FlightsSkeleton count={6} />;
  if (error) return <FlightsError error={error} onRetry={() => window.location.reload()} />;
  if (flights.length === 0) return <NoFlightsFound searchParams={searchParams} />;

  return (
    <div className="flights-container" role="main" aria-label={`${flights.length} flights found`}>
      <FlightsHeader
        count={flights.length}
        searchParams={searchParams}
        onSort={handleSort}
        sortField={sortField}
        sortDirection={sortDirection}
      />

      <FlightsFilters
        filters={filters}
        onChange={setFilters}
        availableAirlines={getUniqueAirlines(flights)}
      />

      <div className="flights-grid">
        {sortedFlights.map(flight => (
          <FlightCard
            key={flight.id}
            flight={flight}
            onBook={() => onBook(flight.id)}
          />
        ))}
      </div>
    </div>
  );
};
```

**Event Handlers**:

```typescript
// Generated by LangGraph agent
const flightEventHandlers = {
  onBook: async (flightId: string) => {
    // Calls back to agent with booking intent
    await sendMessage({
      type: "tool_call",
      tool: "bookFlight",
      parameters: { flightId },
    });
  },

  onSort: (field: SortField) => {
    // Local state update - no agent interaction
    setSortField(field);
  },

  onFilter: (filters: FlightFilters) => {
    // Triggers new search if filters change core params
    if (filtersAffectSearch(filters)) {
      sendMessage({
        type: "tool_call",
        tool: "listFlights",
        parameters: { ...searchParams, ...filters },
      });
    }
  },
};
```

### `FlightCard`

**Subcomponent Structure**:

```typescript
const FlightCard: FC<{ flight: Flight; onBook: () => void }> = ({ flight, onBook }) => (
  <div className="flight-card" data-testid={`flight-${flight.id}`}>
    <FlightHeader airline={flight.airline} flightNumber={flight.flightNumber} />

    <FlightRoute
      departure={flight.departure}
      arrival={flight.arrival}
      duration={flight.duration}
      stops={flight.stops}
    />

    <FlightDetails
      aircraft={flight.aircraft}
      availability={flight.availability}
    />

    <FlightPricing
      price={flight.price}
      taxes={flight.taxes}
      total={flight.totalPrice}
    />

    <FlightActions onBook={onBook} disabled={flight.availability.economy === 0} />
  </div>
);
```

## 🏨 Hotel Components

### `HotelsList`

Similar structure to FlightsList but with hotel-specific props and behaviors:

```typescript
interface HotelsListProps {
  hotels: Hotel[];
  searchParams: HotelSearchParams;
  onBook: (hotelId: string, roomId: string) => void;
  onViewDetails: (hotelId: string) => void;
  mapView?: boolean;
  loading?: boolean;
}
```

**Unique Features**:

- 🗺️ **Map Integration**: Toggle between list/map view
- 📸 **Image Gallery**: Carousel for hotel photos
- ⭐ **Rating Display**: Stars + numeric score + reviews count
- 🏊 **Amenities Filter**: Visual icons for pool, WiFi, etc.

### `HotelCard`

**Layout Sections**:

```typescript
const HotelCard = ({ hotel, onBook, onViewDetails }) => (
  <div className="hotel-card">
    <HotelImageGallery images={hotel.images} />
    <HotelInfo
      name={hotel.name}
      address={hotel.address}
      rating={hotel.rating}
      reviewScore={hotel.reviewScore}
    />
    <HotelAmenities amenities={hotel.amenities} />
    <HotelRooms rooms={hotel.rooms} onBook={onBook} />
    <HotelPolicies policies={hotel.policies} />
  </div>
);
```

## 💳 Booking Components

### `BookingConfirmation`

**Props Interface**:

```typescript
interface BookingConfirmationProps {
  pnr: string;
  booking: BookingDetails;
  type: "flight" | "hotel";
  onCancel?: () => void;
  onModify?: () => void;
  onDownloadTicket?: () => void;
}
```

**Component Features**:

```typescript
const BookingConfirmation = ({ pnr, booking, type, onCancel }) => (
  <div className="booking-confirmation" role="dialog" aria-labelledby="booking-title">
    <BookingHeader pnr={pnr} status={booking.status} />

    <BookingDetails booking={booking} type={type} />

    <BookingTimeline
      events={booking.timeline}
      currentStatus={booking.status}
    />

    <BookingActions
      onCancel={onCancel}
      onModify={onModify}
      onDownload={onDownloadTicket}
      cancelPolicy={booking.cancelPolicy}
    />

    <BookingSupport
      contactInfo={booking.support}
      faqItems={getBookingFAQ(type)}
    />
  </div>
);
```

## 📱 Loading & Error States

### `LoadingSkeleton`

**Adaptive Skeletons**:

```typescript
const LoadingSkeleton = ({ type, count = 3 }: { type: 'flights' | 'hotels', count?: number }) => {
  const skeletonComponents = {
    flights: FlightCardSkeleton,
    hotels: HotelCardSkeleton
  };

  const SkeletonComponent = skeletonComponents[type];

  return (
    <div className="loading-container" role="status" aria-label="Loading results">
      {Array.from({ length: count }, (_, i) => (
        <SkeletonComponent key={i} delay={i * 100} />
      ))}
    </div>
  );
};
```

### `ErrorBoundary`

**Graceful Degradation**:

```typescript
class UIErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    // Log to monitoring service
    logError('UI Component Error', { error, errorInfo, component: this.props.componentName });
  }

  render() {
    if (this.state.hasError) {
      return (
        <ErrorFallback
          error={this.state.error}
          componentName={this.props.componentName}
          onRetry={() => this.setState({ hasError: false, error: null })}
        />
      );
    }

    return this.props.children;
  }
}
```

## 🔄 Real-time Streaming

### Incremental UI Updates

```typescript
// Agent streams partial UI updates
const streamFlightResults = async function* (searchParams) {
  // 1. Show loading state
  yield {
    type: "ui_update",
    component: "FlightsList",
    props: { loading: true, flights: [] },
  };

  // 2. Stream partial results
  const partialFlights = await getPartialFlights(searchParams);
  yield {
    type: "ui_update",
    component: "FlightsList",
    props: {
      loading: true,
      flights: partialFlights,
      message: `Found ${partialFlights.length} flights, searching for more...`,
    },
  };

  // 3. Final results
  const allFlights = await getAllFlights(searchParams);
  yield {
    type: "ui_update",
    component: "FlightsList",
    props: {
      loading: false,
      flights: allFlights,
      searchParams,
    },
  };
};
```

### Progressive Enhancement

```typescript
// UI updates progressively as more data arrives
const useProgressiveFlights = (searchId: string) => {
  const [flightsState, setFlightsState] = useState({
    flights: [],
    loading: true,
    progress: 0,
  });

  useEffect(() => {
    const eventSource = new EventSource(`/api/flights/${searchId}/stream`);

    eventSource.onmessage = (event) => {
      const update = JSON.parse(event.data);

      setFlightsState((prev) => ({
        flights: [...prev.flights, ...update.newFlights],
        loading: update.loading,
        progress: update.progress,
      }));
    };

    return () => eventSource.close();
  }, [searchId]);

  return flightsState;
};
```

## 🎯 Event Handling System

### Agent Communication

```typescript
// Bidirectional communication between UI and agent
const useAgentCommunication = () => {
  const sendToAgent = async (message: AgentMessage) => {
    return await fetch("/api/agent/message", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(message),
    });
  };

  const handleToolCall = async (toolName: string, params: any) => {
    return sendToAgent({
      type: "tool_call",
      tool: toolName,
      parameters: params,
      threadId: getCurrentThreadId(),
    });
  };

  return { sendToAgent, handleToolCall };
};
```

### Component Event Registry

```typescript
// Each component registers its available events
const COMPONENT_EVENTS = {
  FlightsList: {
    onBook: "Triggers flight booking flow",
    onSort: "Local sorting, no agent call",
    onFilter: "May trigger new search if core params change",
  },
  HotelsList: {
    onBook: "Triggers hotel booking flow",
    onViewDetails: "Expands hotel details inline",
    onMapToggle: "Switches between list/map view",
  },
  BookingConfirmation: {
    onCancel: "Triggers cancellation flow",
    onModify: "Triggers modification flow",
    onDownload: "Downloads PDF ticket/voucher",
  },
} as const;
```

## 🎨 Styling & Theming

### CSS-in-JS with Emotion

```typescript
import styled from "@emotion/styled";

const FlightCard = styled.div<{ selected?: boolean }>`
  background: ${(props) => props.theme.colors.surface};
  border: 1px solid
    ${(props) =>
      props.selected ? props.theme.colors.primary : props.theme.colors.border};
  border-radius: 12px;
  padding: 24px;
  transition: all 0.2s ease;

  &:hover {
    box-shadow: ${(props) => props.theme.shadows.medium};
    transform: translateY(-2px);
  }
`;
```

### Theme Configuration

```typescript
const theme = {
  colors: {
    primary: "#2563eb",
    surface: "#ffffff",
    border: "#e5e7eb",
    text: {
      primary: "#111827",
      secondary: "#6b7280",
    },
  },
  typography: {
    fontFamily: "Inter, sans-serif",
    sizes: {
      xs: "0.75rem",
      sm: "0.875rem",
      base: "1rem",
      lg: "1.125rem",
      xl: "1.25rem",
    },
  },
  shadows: {
    small: "0 1px 2px 0 rgb(0 0 0 / 0.05)",
    medium: "0 4px 6px -1px rgb(0 0 0 / 0.1)",
    large: "0 10px 15px -3px rgb(0 0 0 / 0.1)",
  },
};
```

## ♿ Accessibility Features

### ARIA Labels & Roles

```typescript
// Each component includes comprehensive a11y
const FlightCard = ({ flight, onBook }) => (
  <div
    role="article"
    aria-labelledby={`flight-${flight.id}-title`}
    aria-describedby={`flight-${flight.id}-details`}
  >
    <h3 id={`flight-${flight.id}-title`}>
      {flight.airline} {flight.flightNumber}
    </h3>

    <div id={`flight-${flight.id}-details`}>
      <span aria-label={`Departure: ${flight.departure.time} from ${flight.departure.airport}`}>
        {formatTime(flight.departure.time)} {flight.departure.airport}
      </span>

      <button
        onClick={onBook}
        aria-describedby={`price-${flight.id}`}
        disabled={flight.availability.economy === 0}
      >
        Book Flight
      </button>

      <span id={`price-${flight.id}`} aria-label={`Price: ${formatCurrency(flight.price)}`}>
        {formatCurrency(flight.price)}
      </span>
    </div>
  </div>
);
```

### Keyboard Navigation

```typescript
// Full keyboard support
const useKeyboardNavigation = (items: any[], onSelect: (item: any) => void) => {
  const [focusedIndex, setFocusedIndex] = useState(0);

  const handleKeyDown = (e: KeyboardEvent) => {
    switch (e.key) {
      case "ArrowDown":
        e.preventDefault();
        setFocusedIndex((prev) => Math.min(prev + 1, items.length - 1));
        break;
      case "ArrowUp":
        e.preventDefault();
        setFocusedIndex((prev) => Math.max(prev - 1, 0));
        break;
      case "Enter":
        e.preventDefault();
        onSelect(items[focusedIndex]);
        break;
    }
  };

  return { focusedIndex, handleKeyDown };
};
```

## 📊 Performance Optimizations

### Virtualization for Large Lists

```typescript
import { FixedSizeList as List } from 'react-window';

const VirtualizedFlightsList = ({ flights, onBook }) => {
  const FlightRow = ({ index, style }) => (
    <div style={style}>
      <FlightCard flight={flights[index]} onBook={onBook} />
    </div>
  );

  return (
    <List
      height={600}
      itemCount={flights.length}
      itemSize={200}
      overscanCount={5}
    >
      {FlightRow}
    </List>
  );
};
```

### Memoization & Optimization

```typescript
// Prevent unnecessary re-renders
const FlightCard = React.memo<FlightCardProps>(({ flight, onBook }) => {
  // Memoize expensive calculations
  const formattedDuration = useMemo(() =>
    formatDuration(flight.duration),
    [flight.duration]
  );

  // Stable callback references
  const handleBook = useCallback(() => onBook(flight.id), [flight.id, onBook]);

  return (
    <div className="flight-card">
      {/* Component implementation */}
    </div>
  );
});
```

---

**Próximo**: [Technical Decisions](./technical-decisions.md) - Explicação das principais decisões arquiteturais e trade-offs do projeto.
